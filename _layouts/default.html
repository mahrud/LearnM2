<!DOCTYPE html>
<html lang="en-us">
  {% include head.html %}
  <body class="theme-base-{{ site.color-scheme }}">
    <nav class="navbar navbar-default" role="navigation">
      <div class="container">
	<div class="navbar-header">
	  <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	    <span class="sr-only">Toggle navigation</span>
	    <span class="icon-bar"></span>
	    <span class="icon-bar"></span>
	    <span class="icon-bar"></span>
	  </button>
	  <a class="navbar-brand" href="{{ site.baseurl }}/"><strong>{{ site.title }}</strong></a>
	</div>
	<div class="collapse navbar-collapse">
	  <ul class="nav navbar-nav">
            <li><a href="{{ site.baseurl }}/">Home</a></li>
            <li><a href="{{ site.baseurl }}/about/">About</a></li>
	  </ul>
	  <form class="navbar-nav navbar-form navbar-right" id="x-search" action="./" role="search">
	    <input class="form-control" id="x-search-query" type="text" name="q" placeholder="Search" />
	  </form>
	</div>
      </div>
    </nav>

    <!-- FIXME -->
    <div class="container">
      <div id="results"></div>
      <ul id="search_results"></ul>
    </div>

    <div class="container" id="main">
<!-- ########################################################################################### -->
{{ content }}
<!-- ########################################################################################### -->
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
    // Highlight search Query
    var url = window.location.href;
    if (url.lastIndexOf("?q=") > 0) {
      // get the index of the parameter, add three (to account for length)
      var stringloc = url.lastIndexOf("?q=") + 3;
      // get the substring (query) and decode
      var searchquery = decodeURIComponent(url.substr(stringloc));
      // regex matches at beginning of line, end of line or word boundary, useful for poetry
      var regex = new RegExp("(?:^|\\b)(" + searchquery + ")(?:$|\\b)", "gim");
      // get, add mark and then set content
      var content = document.getElementById("main").innerHTML;
      document.getElementById("main").innerHTML = content.replace(regex, "<mark>$1</mark>");
    }

    // Toggle sidebar
    (function(document) {
      var toggle = document.querySelector('.sidebar-toggle');
      var sidebar = document.querySelector('#sidebar');
      var checkbox = document.querySelector('#sidebar-checkbox');

      document.addEventListener('click', function(e) {
        var target = e.target;

        if(!checkbox.checked ||
           !sidebar.contains(target) ||
           (target === checkbox || target === toggle)) return;

        checkbox.checked = false;
      }, false);
    })(document);
    </script>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
      integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/elasticlunr@0.9.5/elasticlunr.min.js"
      integrity="sha256-cUqUYjN4U6JfE3pqo/8aqbyS/Y3T0dNljhd+R1wGUYE=" crossorigin="anonymous"></script>
    <script src="{{site.baseurl}}/static/search.js"></script>
  </body>
</html>
